<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NeoCalc - Calculator & Currency</title>
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-dark: #1e1e24;
            --bg-light: #25252d;
            --shadow-light: #32323c;
            --shadow-dark: #16161c;
            --accent: #6c5ce7;
            --accent-glow: #a29bfe;
            --success: #00b894;
            --danger: #ff7675;
        }

        body {
            background: var(--bg-dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .neumorphic {
            background: var(--bg-dark);
            box-shadow: 8px 8px 16px var(--shadow-dark), 
                        -8px -8px 16px var(--shadow-light);
            border-radius: 20px;
        }

        .neumorphic-inset {
            background: var(--bg-dark);
            box-shadow: inset 5px 5px 10px var(--shadow-dark), 
                        inset -5px -5px 10px var(--shadow-light);
            border-radius: 15px;
        }

        .neumorphic-btn {
            background: var(--bg-dark);
            box-shadow: 6px 6px 12px var(--shadow-dark), 
                        -6px -6px 12px var(--shadow-light);
            border-radius: 18px;
            transition: all 0.15s ease;
        }

        .neumorphic-btn:hover {
            box-shadow: 4px 4px 8px var(--shadow-dark), 
                        -4px -4px 8px var(--shadow-light);
        }

        .neumorphic-btn:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark), 
                        inset -4px -4px 8px var(--shadow-light);
            transform: scale(0.98);
        }

        .neumorphic-btn-accent {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            box-shadow: 6px 6px 12px var(--shadow-dark), 
                        -6px -6px 12px var(--shadow-light);
        }

        .neumorphic-btn-accent:hover {
            box-shadow: 4px 4px 8px var(--shadow-dark), 
                        -4px -4px 8px var(--shadow-light);
        }

        .neumorphic-btn-accent:active {
            box-shadow: inset 4px 4px 8px rgba(0,0,0,0.3);
            transform: scale(0.98);
        }

        .neumorphic-btn-danger {
            background: linear-gradient(135deg, #e17055, var(--danger));
            box-shadow: 6px 6px 12px var(--shadow-dark), 
                        -6px -6px 12px var(--shadow-light);
        }

        .display-screen {
            background: linear-gradient(145deg, #1a1a20, #22222a);
            box-shadow: inset 3px 3px 6px var(--shadow-dark), 
                        inset -3px -3px 6px var(--shadow-light);
        }

        .tab-active {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4);
        }

        .glow-text {
            text-shadow: 0 0 20px rgba(108, 92, 231, 0.5);
        }

        .currency-card {
            transition: all 0.3s ease;
        }

        .currency-card:hover {
            transform: translateY(-2px);
        }

        .rate-up {
            color: var(--success);
        }

        .rate-down {
            color: var(--danger);
        }

        .pulse-dot {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .slide-up {
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }

        .spinner {
            border: 3px solid var(--shadow-light);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center p-4 min-h-screen">
    <!-- Mobile App Container -->
    <div class="neumorphic w-full max-w-md overflow-hidden slide-up">
        <!-- Status Bar -->
        <div class="flex items-center justify-between px-6 py-3 text-gray-400 text-sm">
            <span id="currentTime">12:00</span>
            <div class="flex items-center gap-2">
                <span class="pulse-dot w-2 h-2 bg-green-500 rounded-full"></span>
                <span class="text-xs">Live</span>
            </div>
            <div class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3C7.46 3 3.34 4.78.29 7.67c-.18.18-.29.43-.29.71 0 .28.11.53.29.71l11 11c.18.18.43.29.71.29.28 0 .53-.11.71-.29l11-11c.18-.18.29-.43.29-.71 0-.28-.11-.53-.29-.71C20.66 4.78 16.54 3 12 3z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17 4h-3V2h-4v2H7v18h10V4z"/></svg>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="flex justify-center gap-2 px-2 mb-4">
            <button onclick="switchTab('calculator')" id="tabCalculator" class="tab-active px-4 py-2.5 rounded-full text-white font-medium transition-all duration-300 flex items-center gap-1 text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                Calc
            </button>
            <button onclick="switchTab('currency')" id="tabCurrency" class="neumorphic-btn px-4 py-2.5 rounded-full text-gray-400 font-medium transition-all duration-300 flex items-center gap-1 text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                Exch
            </button>
            <button onclick="switchTab('trade')" id="tabTrade" class="neumorphic-btn px-4 py-2.5 rounded-full text-gray-400 font-medium transition-all duration-300 flex items-center gap-1 text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                Trade
            </button>
        </div>

        <!-- Calculator Section -->
        <div id="calculatorSection" class="px-5 pb-6">
            <!-- Display -->
            <div class="display-screen rounded-2xl p-5 mb-5">
                <div class="text-right">
                    <div id="calcExpression" class="text-gray-500 text-sm h-6 overflow-hidden"></div>
                    <div id="calcDisplay" class="text-white text-4xl font-light glow-text overflow-hidden">0</div>
                </div>
            </div>

            <!-- Calculator Buttons -->
            <div class="grid grid-cols-4 gap-3">
                <button onclick="clearAll()" class="neumorphic-btn-danger h-14 text-white font-medium text-lg">AC</button>
                <button onclick="toggleSign()" class="neumorphic-btn h-14 text-white font-medium text-lg">Â±</button>
                <button onclick="inputPercent()" class="neumorphic-btn h-14 text-white font-medium text-lg">%</button>
                <button onclick="inputOperator('/')" class="neumorphic-btn-accent h-14 text-white font-medium text-xl">Ã·</button>

                <button onclick="inputNumber('7')" class="neumorphic-btn h-16 text-white font-medium text-2xl">7</button>
                <button onclick="inputNumber('8')" class="neumorphic-btn h-16 text-white font-medium text-2xl">8</button>
                <button onclick="inputNumber('9')" class="neumorphic-btn h-16 text-white font-medium text-2xl">9</button>
                <button onclick="inputOperator('*')" class="neumorphic-btn-accent h-14 text-white font-medium text-xl">Ã—</button>

                <button onclick="inputNumber('4')" class="neumorphic-btn h-16 text-white font-medium text-2xl">4</button>
                <button onclick="inputNumber('5')" class="neumorphic-btn h-16 text-white font-medium text-2xl">5</button>
                <button onclick="inputNumber('6')" class="neumorphic-btn h-16 text-white font-medium text-2xl">6</button>
                <button onclick="inputOperator('-')" class="neumorphic-btn-accent h-14 text-white font-medium text-xl">âˆ’</button>

                <button onclick="inputNumber('1')" class="neumorphic-btn h-16 text-white font-medium text-2xl">1</button>
                <button onclick="inputNumber('2')" class="neumorphic-btn h-16 text-white font-medium text-2xl">2</button>
                <button onclick="inputNumber('3')" class="neumorphic-btn h-16 text-white font-medium text-2xl">3</button>
                <button onclick="inputOperator('+')" class="neumorphic-btn-accent h-14 text-white font-medium text-xl">+</button>

                <button onclick="inputNumber('0')" class="neumorphic-btn h-16 text-white font-medium text-2xl col-span-2">0</button>
                <button onclick="inputDecimal()" class="neumorphic-btn h-16 text-white font-medium text-2xl">.</button>
                <button onclick="calculate()" class="neumorphic-btn-accent h-16 text-white font-medium text-2xl">=</button>
            </div>
        </div>

        <!-- Currency Section -->
        <div id="currencySection" class="px-5 pb-6 hidden">
            <!-- Currency Converter -->
            <div class="neumorphic-inset p-4 mb-5">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-white font-medium">Currency Converter</h3>
                    <button onclick="refreshRates()" class="neumorphic-btn p-2 text-gray-400 hover:text-white">
                        <svg id="refreshIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </button>
                </div>

                <!-- From Currency -->
                <div class="neumorphic p-3 mb-3">
                    <div class="flex items-center justify-between">
                        <select id="fromCurrency" onchange="convertCurrency()" class="bg-transparent text-white text-xl font-semibold outline-none cursor-pointer">
                            <option value="USD" class="bg-gray-800">ğŸ‡ºğŸ‡¸ USD</option>
                            <option value="EUR" class="bg-gray-800">ğŸ‡ªğŸ‡º EUR</option>
                            <option value="GBP" class="bg-gray-800">ğŸ‡¬ğŸ‡§ GBP</option>
                            <option value="JPY" class="bg-gray-800">ğŸ‡¯ğŸ‡µ JPY</option>
                            <option value="INR" class="bg-gray-800">ğŸ‡®ğŸ‡³ INR</option>
                            <option value="AUD" class="bg-gray-800">ğŸ‡¦ğŸ‡º AUD</option>
                            <option value="CAD" class="bg-gray-800">ğŸ‡¨ğŸ‡¦ CAD</option>
                            <option value="CNY" class="bg-gray-800">ğŸ‡¨ğŸ‡³ CNY</option>
                            <option value="CHF" class="bg-gray-800">ğŸ‡¨ğŸ‡­ CHF</option>
                            <option value="KRW" class="bg-gray-800">ğŸ‡°ğŸ‡· KRW</option>
                            <option value="SGD" class="bg-gray-800">ğŸ‡¸ğŸ‡¬ SGD</option>
                            <option value="HKD" class="bg-gray-800">ğŸ‡­ğŸ‡° HKD</option>
                        </select>
                        <input type="number" id="fromAmount" value="1" oninput="convertCurrency()" class="neumorphic-inset w-28 px-3 py-2 text-right text-white text-lg outline-none">
                    </div>
                </div>

                <!-- Swap Button -->
                <div class="flex justify-center -my-2 relative z-10">
                    <button onclick="swapCurrencies()" class="neumorphic-btn-accent w-10 h-10 rounded-full flex items-center justify-center text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                        </svg>
                    </button>
                </div>

                <!-- To Currency -->
                <div class="neumorphic p-3 mt-3">
                    <div class="flex items-center justify-between">
                        <select id="toCurrency" onchange="convertCurrency()" class="bg-transparent text-white text-xl font-semibold outline-none cursor-pointer">
                            <option value="EUR" class="bg-gray-800">ğŸ‡ªğŸ‡º EUR</option>
                            <option value="USD" class="bg-gray-800">ğŸ‡ºğŸ‡¸ USD</option>
                            <option value="GBP" class="bg-gray-800">ğŸ‡¬ğŸ‡§ GBP</option>
                            <option value="JPY" class="bg-gray-800">ğŸ‡¯ğŸ‡µ JPY</option>
                            <option value="INR" class="bg-gray-800">ğŸ‡®ğŸ‡³ INR</option>
                            <option value="AUD" class="bg-gray-800">ğŸ‡¦ğŸ‡º AUD</option>
                            <option value="CAD" class="bg-gray-800">ğŸ‡¨ğŸ‡¦ CAD</option>
                            <option value="CNY" class="bg-gray-800">ğŸ‡¨ğŸ‡³ CNY</option>
                            <option value="CHF" class="bg-gray-800">ğŸ‡¨ğŸ‡­ CHF</option>
                            <option value="KRW" class="bg-gray-800">ğŸ‡°ğŸ‡· KRW</option>
                            <option value="SGD" class="bg-gray-800">ğŸ‡¸ğŸ‡¬ SGD</option>
                            <option value="HKD" class="bg-gray-800">ğŸ‡­ğŸ‡° HKD</option>
                        </select>
                        <div id="toAmount" class="neumorphic-inset w-28 px-3 py-2 text-right text-white text-lg">0.00</div>
                    </div>
                </div>

                <!-- Exchange Rate Info -->
                <div class="mt-4 text-center">
                    <p id="exchangeRate" class="text-gray-400 text-sm">Loading exchange rates...</p>
                    <p id="lastUpdate" class="text-gray-600 text-xs mt-1"></p>
                </div>
            </div>

            <!-- Popular Rates -->
            <h3 class="text-white font-medium mb-3 flex items-center gap-2">
                <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                </svg>
                Live Rates (Base: USD)
            </h3>
            <div id="ratesContainer" class="space-y-3 max-h-64 overflow-y-auto pr-2">
            </div>
        </div>

        <!-- Trade Section -->
        <div id="tradeSection" class="px-5 pb-6 hidden">
             <!-- Trade Calculator -->
             <div class="neumorphic-inset p-4 mb-5">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-white font-medium">Profit & Loss Calculator</h3>
                </div>

                <!-- Instrument & Action -->
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <select id="tradeInstrument" onchange="updateTradePlaceholder()" class="neumorphic p-2 text-white bg-transparent outline-none text-sm w-full border-none">
                        <option value="XAUUSD" class="bg-gray-800">Gold (XAU)</option>
                        <option value="XAGUSD" class="bg-gray-800">Silver (XAG)</option>
                        <option value="EURUSD" class="bg-gray-800">EUR/USD</option>
                        <option value="GBPUSD" class="bg-gray-800">GBP/USD</option>
                        <option value="USDJPY" class="bg-gray-800">USD/JPY</option>
                        <option value="BTCUSD" class="bg-gray-800">BTC/USD</option>
                        <option value="US30" class="bg-gray-800">US30</option>
                        <option value="NAS100" class="bg-gray-800">NAS100</option>
                    </select>
                    
                    <div class="neumorphic p-1 flex rounded-lg">
                        <button onclick="setTradeType('buy')" id="btnBuy" class="flex-1 rounded-md text-sm font-medium transition-colors bg-green-500 text-white">Buy</button>
                        <button onclick="setTradeType('sell')" id="btnSell" class="flex-1 rounded-md text-sm font-medium transition-colors text-gray-400">Sell</button>
                    </div>
                </div>

                <!-- Inputs -->
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <label class="text-gray-400 text-sm">Lot Size</label>
                        <input type="number" id="lotSize" value="1.00" step="0.01" class="neumorphic-inset w-28 px-3 py-2 text-right text-white text-sm outline-none">
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="text-gray-400 text-sm">Entry Price</label>
                        <input type="number" id="entryPrice" placeholder="0.00" class="neumorphic-inset w-28 px-3 py-2 text-right text-white text-sm outline-none">
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="text-gray-400 text-sm">Exit Price</label>
                        <input type="number" id="exitPrice" placeholder="0.00" class="neumorphic-inset w-28 px-3 py-2 text-right text-white text-sm outline-none">
                    </div>
                </div>

                <!-- Calculate Button -->
                <button onclick="calculateProfit()" class="mt-4 w-full neumorphic-btn-accent py-3 rounded-xl text-white font-medium">Calculate</button>
             </div>

             <!-- Results -->
             <div class="neumorphic p-4 text-center">
                 <p class="text-gray-400 text-xs uppercase tracking-wider mb-1">Estimated Profit/Loss</p>
                 <div id="tradeResult" class="text-3xl font-light text-white mb-1">$0.00</div>
                 <div id="pipsResult" class="text-sm text-gray-500">0 Pips</div>
             </div>
        </div>

        <!-- Footer -->
        <div class="text-center pb-4 pt-2">
            <p class="text-gray-600 text-xs">NeoCalc v1.0 â€¢ Made with â¤ï¸</p>
        </div>
    </div>

    <script>
        // Calculator State
        let currentValue = '0';
        let previousValue = '';
        let operator = null;
        let shouldResetDisplay = false;

        // Currency Data
        let exchangeRates = {};
        const currencyFlags = {
            USD: 'ğŸ‡ºğŸ‡¸', EUR: 'ğŸ‡ªğŸ‡º', GBP: 'ğŸ‡¬ğŸ‡§', JPY: 'ğŸ‡¯ğŸ‡µ', INR: 'ğŸ‡®ğŸ‡³',
            AUD: 'ğŸ‡¦ğŸ‡º', CAD: 'ğŸ‡¨ğŸ‡¦', CNY: 'ğŸ‡¨ğŸ‡³', CHF: 'ğŸ‡¨ğŸ‡­', KRW: 'ğŸ‡°ğŸ‡·',
            SGD: 'ğŸ‡¸ğŸ‡¬', HKD: 'ğŸ‡­ğŸ‡°'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateTime();
            setInterval(updateTime, 1000);
            fetchExchangeRates();
            setInterval(fetchExchangeRates, 60000);
            updateTradePlaceholder();
        });

        // Time Update
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}`;
        }

        // Trade State
        let tradeType = 'buy';
        const instruments = {
            'XAUUSD': { contract: 100, tick: 0.01 },
            'XAGUSD': { contract: 5000, tick: 0.01 },
            'EURUSD': { contract: 100000, tick: 0.0001 },
            'GBPUSD': { contract: 100000, tick: 0.0001 },
            'USDJPY': { contract: 100000, tick: 0.01 },
            'BTCUSD': { contract: 1, tick: 0.01 },
            'US30': { contract: 1, tick: 1 },
            'NAS100': { contract: 1, tick: 1 }
        };

        // Tab Switching
        function switchTab(tab) {
            const sections = ['calculator', 'currency', 'trade'];
            
            sections.forEach(s => {
                const sectionEl = document.getElementById(s + 'Section');
                const btnEl = document.getElementById('tab' + s.charAt(0).toUpperCase() + s.slice(1));
                
                if (s === tab) {
                    sectionEl.classList.remove('hidden');
                    btnEl.classList.add('tab-active', 'text-white');
                    btnEl.classList.remove('neumorphic-btn', 'text-gray-400');
                } else {
                    sectionEl.classList.add('hidden');
                    btnEl.classList.remove('tab-active', 'text-white');
                    btnEl.classList.add('neumorphic-btn', 'text-gray-400');
                }
            });
        }

        // Trade Functions
        function setTradeType(type) {
            tradeType = type;
            const btnBuy = document.getElementById('btnBuy');
            const btnSell = document.getElementById('btnSell');
            
            if (type === 'buy') {
                btnBuy.classList.add('bg-green-500', 'text-white');
                btnBuy.classList.remove('text-gray-400');
                btnSell.classList.remove('bg-red-500', 'text-white');
                btnSell.classList.add('text-gray-400');
            } else {
                btnSell.classList.add('bg-red-500', 'text-white');
                btnSell.classList.remove('text-gray-400');
                btnBuy.classList.remove('bg-green-500', 'text-white');
                btnBuy.classList.add('text-gray-400');
            }
        }

        function updateTradePlaceholder() {
            const instrument = document.getElementById('tradeInstrument').value;
            const entryInput = document.getElementById('entryPrice');
            const exitInput = document.getElementById('exitPrice');
            
            const typicalPrices = {
                'XAUUSD': '2030.50',
                'XAGUSD': '22.80',
                'EURUSD': '1.0850',
                'GBPUSD': '1.2650',
                'USDJPY': '149.50',
                'BTCUSD': '64500.00',
                'US30': '39000.00',
                'NAS100': '18000.00'
            };
            
            if (typicalPrices[instrument]) {
                entryInput.placeholder = typicalPrices[instrument];
                exitInput.placeholder = typicalPrices[instrument];
            }
        }

        function calculateProfit() {
            const instrument = document.getElementById('tradeInstrument').value;
            const lots = parseFloat(document.getElementById('lotSize').value) || 0;
            const entry = parseFloat(document.getElementById('entryPrice').value) || 0;
            const exit = parseFloat(document.getElementById('exitPrice').value) || 0;
            
            if (!lots || !entry || !exit) return;

            const contractSize = instruments[instrument].contract;
            let profit = 0;
            let pips = 0;

            if (tradeType === 'buy') {
                profit = (exit - entry) * contractSize * lots;
                pips = (exit - entry) / instruments[instrument].tick;
            } else {
                profit = (entry - exit) * contractSize * lots;
                pips = (entry - exit) / instruments[instrument].tick;
            }
            
            if (instrument === 'USDJPY') {
                profit = profit / exit;
            }

            const resultEl = document.getElementById('tradeResult');
            const pipsEl = document.getElementById('pipsResult');
            
            const sign = profit >= 0 ? '+' : '-';
            const colorClass = profit >= 0 ? 'text-green-500' : 'text-red-500';
            
            resultEl.className = `text-3xl font-light mb-1 ${colorClass}`;
            resultEl.textContent = `${sign}$${Math.abs(profit).toFixed(2)}`;
            pipsEl.textContent = `${Math.abs(pips).toFixed(1)} Points/Pips`;
        }

        function updateDisplay() {
            const display = document.getElementById('calcDisplay');
            const expression = document.getElementById('calcExpression');
            
            let displayValue = currentValue;
            if (displayValue.length > 12) {
                displayValue = parseFloat(displayValue).toExponential(6);
            }
            display.textContent = displayValue;

            if (previousValue && operator) {
                const opSymbol = { '+': '+', '-': 'âˆ’', '*': 'Ã—', '/': 'Ã·' }[operator];
                expression.textContent = `${previousValue} ${opSymbol}`;
            } else {
                expression.textContent = '';
            }
        }

        function inputNumber(num) {
            if (shouldResetDisplay) {
                currentValue = num;
                shouldResetDisplay = false;
            } else {
                currentValue = currentValue === '0' ? num : currentValue + num;
            }
            updateDisplay();
        }

        function inputDecimal() {
            if (shouldResetDisplay) {
                currentValue = '0.';
                shouldResetDisplay = false;
            } else if (!currentValue.includes('.')) {
                currentValue += '.';
            }
            updateDisplay();
        }

        function inputOperator(op) {
            if (operator && !shouldResetDisplay) {
                calculate();
            }
            previousValue = currentValue;
            operator = op;
            shouldResetDisplay = true;
            updateDisplay();
        }

        function calculate() {
            if (!operator || !previousValue) return;
            const prev = parseFloat(previousValue);
            const current = parseFloat(currentValue);
            let result;

            switch (operator) {
                case '+': result = prev + current; break;
                case '-': result = prev - current; break;
                case '*': result = prev * current; break;
                case '/': result = current !== 0 ? prev / current : 'Error'; break;
            }

            currentValue = typeof result === 'number' ? 
                parseFloat(result.toFixed(10)).toString() : result;
            operator = null;
            previousValue = '';
            shouldResetDisplay = true;
            updateDisplay();
        }

        function clearAll() {
            currentValue = '0';
            previousValue = '';
            operator = null;
            shouldResetDisplay = false;
            updateDisplay();
        }

        function toggleSign() {
            currentValue = (parseFloat(currentValue) * -1).toString();
            updateDisplay();
        }

        function inputPercent() {
            currentValue = (parseFloat(currentValue) / 100).toString();
            updateDisplay();
        }

        async function fetchExchangeRates() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                exchangeRates = data.rates;
                
                convertCurrency();
                updateRatesDisplay();
                
                const now = new Date();
                document.getElementById('lastUpdate').textContent = 
                    `Last updated: ${now.toLocaleTimeString()}`;
            } catch (error) {
                console.error('Error fetching rates:', error);
                exchangeRates = {
                    USD: 1, EUR: 0.85, GBP: 0.73, JPY: 110.0, INR: 83.0,
                    AUD: 1.35, CAD: 1.25, CNY: 6.45, CHF: 0.92, KRW: 1180,
                    SGD: 1.35, HKD: 7.8
                };
                convertCurrency();
                updateRatesDisplay();
            }
        }

        function refreshRates() {
            const icon = document.getElementById('refreshIcon');
            icon.classList.add('animate-spin');
            fetchExchangeRates().then(() => {
                setTimeout(() => icon.classList.remove('animate-spin'), 500);
            });
        }

        function convertCurrency() {
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            const amount = parseFloat(document.getElementById('fromAmount').value) || 0;

            const rate = exchangeRates[to] / exchangeRates[from];
            const result = (amount * rate).toFixed(2);

            document.getElementById('toAmount').textContent = result;
            document.getElementById('exchangeRate').innerHTML = 
                `1 ${from} = <span class="text-purple-400 font-medium">${rate.toFixed(4)}</span> ${to}`;
        }

        function swapCurrencies() {
            const from = document.getElementById('fromCurrency');
            const to = document.getElementById('toCurrency');
            const temp = from.value;
            from.value = to.value;
            to.value = temp;
            convertCurrency();
        }

        function updateRatesDisplay() {
            const container = document.getElementById('ratesContainer');
            const baseCurrency = 'USD';
            const currencies = ['EUR', 'GBP', 'JPY', 'INR', 'AUD', 'CAD', 'CNY', 'CHF', 'KRW', 'SGD', 'HKD'];
            
            let html = '';
            currencies.forEach(curr => {
                const rate = exchangeRates[curr] || 1;
                const change = (Math.random() - 0.5) * 2;
                const changeClass = change >= 0 ? 'rate-up' : 'rate-down';
                const changeIcon = change >= 0 ? 'â†‘' : 'â†“';
                
                html += `
                    <div class="neumorphic currency-card p-3 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${currencyFlags[curr]}</span>
                            <div>
                                <p class="text-white font-medium">${curr}</p>
                                <p class="text-gray-500 text-xs">${baseCurrency}/${curr}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-white font-medium">${rate.toFixed(4)}</p>
                            <p class="text-xs ${changeClass}">${changeIcon} ${Math.abs(change).toFixed(2)}%</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('calculatorSection').classList.contains('hidden')) return;
            
            if (e.key >= '0' && e.key <= '9') inputNumber(e.key);
            else if (e.key === '.') inputDecimal();
            else if (e.key === '+') inputOperator('+');
            else if (e.key === '-') inputOperator('-');
            else if (e.key === '*') inputOperator('*');
            else if (e.key === '/') inputOperator('/');
            else if (e.key === 'Enter' || e.key === '=') calculate();
            else if (e.key === 'Escape') clearAll();
            else if (e.key === 'Backspace') {
                currentValue = currentValue.slice(0, -1) || '0';
                updateDisplay();
            }
        });
    </script>
</body>
</html>
